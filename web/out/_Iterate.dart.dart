// Auto-generated from Iterate.html.
// DO NOT EDIT.

library Iterate_html;

import 'dart:html' as autogenerated;
import 'package:web_components/watcher.dart' as autogenerated;

import 'dart:html';


// Original code
List<String> features = const <String>['lexical scope',
                              'closures',
                              'getters and setters',
                              'isolates',
                              'top-level functions',
                              'optional static types',
                              'one-line functions',
                              'familiar syntax',
                              'map and list literals',
                              'generics'];

List<String> userFavorites = new List<String>();  // TODO use set when it can be watched

addToFavorites(e) {
  String fav = e.target.value;
  int index = userFavorites.indexOf(fav);
  
  if (e.target.checked && index < 0) {
    userFavorites.add(fav);
  } else if (!e.target.checked && index >= 0) {
    userFavorites.removeAt(index);
  }
  
  userFavorites.sort();
}

main() { }

// Additional generated code

autogenerated.UnknownElement __e3;

// Fields for template list 'feature in features'
autogenerated.WatcherDisposer _stopWatcher__e2;
List<autogenerated.WatcherDisposer> _removeChild__e2 = [];

autogenerated.UnknownElement __e6;

// Fields for template list 'fav in userFavorites'
autogenerated.WatcherDisposer _stopWatcher__e5;
List<autogenerated.WatcherDisposer> _removeChild__e5 = [];


/** Create the views and bind them to models. */
void init_autogenerated() {
  // Create view.
  var _root = new autogenerated.DocumentFragment.html(_INITIAL_PAGE);

  // Initialize fields.
  __e3 = _root.query('#__e-3');
  
  __e6 = _root.query('#__e-6');
  

  // Attach model to views.
  _stopWatcher__e2 = autogenerated.watchAndInvoke(() => features, (e) {
    for (var remover in _removeChild__e2) remover();
    _removeChild__e2.clear();
    
    var _insert__e2 = __e3.nextNode;
    
    for (var feature in features) {
      
      autogenerated.LIElement __e2;
      autogenerated.InputElement __e0;
      autogenerated.EventListener _listener__e0_click_1;
      autogenerated.WatcherDisposer _stopWatcher__e0_2;
      autogenerated.SpanElement __e1;
      autogenerated.WatcherDisposer _stopWatcher__e1_3;
      
      __e2 = new autogenerated.Element.html('''
      <li><input type="checkbox" id="__e-0"> <span id="__e-1"></span></li>''');
      __e0 = __e2.query('#__e-0');
      __e1 = __e2.query('#__e-1');
      
      __e3.parent.insertBefore(__e2, _insert__e2);
      
      // Attach listeners/watchers
      
      _listener__e0_click_1 = (e) {
        addToFavorites(e);
        autogenerated.dispatch();
      };
      __e0.on.click.add(_listener__e0_click_1);
      
      _stopWatcher__e0_2 = autogenerated.watchAndInvoke(() =>  feature , (e) {
        __e0.value = e.newValue;
      });
      
      _stopWatcher__e1_3 = autogenerated.watchAndInvoke(() =>  feature , (e) {
        __e1.innerHTML = '${ feature }';
      });
      
      // Remember to unregister them
      
      _removeChild__e2.add(() {
        
        __e2.remove();
        
        __e2 = null;
        _stopWatcher__e0_2();
        __e0.on.click.remove(_listener__e0_click_1);
        _listener__e0_click_1 = null;
        
        __e0 = null;
        _stopWatcher__e1_3();
        __e1 = null;
        
      });
    }
  });
  
  _stopWatcher__e5 = autogenerated.watchAndInvoke(() => userFavorites, (e) {
    for (var remover in _removeChild__e5) remover();
    _removeChild__e5.clear();
    
    var _insert__e5 = __e6.nextNode;
    
    for (var fav in userFavorites) {
      
      autogenerated.LIElement __e5;
      autogenerated.SpanElement __e4;
      autogenerated.WatcherDisposer _stopWatcher__e4_1;
      
      __e5 = new autogenerated.Element.html('''
      <li><span id="__e-4"></span></li>''');
      __e4 = __e5.query('#__e-4');
      
      __e6.parent.insertBefore(__e5, _insert__e5);
      
      // Attach listeners/watchers
      
      _stopWatcher__e4_1 = autogenerated.watchAndInvoke(() =>  fav , (e) {
        __e4.innerHTML = '${ fav }';
      });
      
      // Remember to unregister them
      
      _removeChild__e5.add(() {
        
        __e5.remove();
        
        __e5 = null;
        _stopWatcher__e4_1();
        __e4 = null;
        
      });
    }
  });
  


  // Attach view to the document.
  autogenerated.document.body.nodes.add(_root);
  _root = autogenerated.document.body;
}

final String _INITIAL_PAGE = '''

    <h1>Hello MDV: Iteration</h1>
    
    <h2>Language features</h2>
    
    <h3>Dart</h3>
      
    <ul>
      <template id="__e-3" style="display:none"></template>
    </ul>
    
    <h3>Your favorite features</h3>
    
    <ul>
      <template id="__e-6" style="display:none"></template>
    </ul>
    
    
    <script src="../dart.js"></script>
  
''';
